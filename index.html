<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Select + Do</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .pill {
      @apply px-3 py-1 border rounded-full text-sm cursor-pointer transition-all;
    }
    .pill-selected {
      @apply bg-blue-600 text-white;
    }
    .tag-pill {
      @apply inline-block bg-blue-100 text-blue-700 px-2 py-1 rounded-full text-sm mr-1 mb-1;
    }
    .modal-overlay {
      @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen">
  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 p-4 bg-white shadow">
      <h1 class="text-xl font-semibold mb-4">Select + Do</h1>
      <button id="addTaskBtn" class="w-full bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">+ Add Task</button>
      <div class="mt-4 space-y-2">
        <button id="exportBtn" class="w-full border px-4 py-2 rounded">Export</button>
        <button id="importBtn" class="w-full border px-4 py-2 rounded">Import</button>
      </div>
      <ul id="taskList" class="mt-4 text-sm text-gray-700 space-y-1"></ul>
    </aside>

    <!-- Main content -->
    <main class="flex-1 p-6">
      <div>
        <h2 class="text-lg font-semibold">How much time do you have?</h2>
        <div id="timeFilter" class="flex flex-wrap gap-2 my-2">
          ${[5, 10, 15, 20, 25, 30, 45, 60].map(t => `<span class="pill" data-time="${t}">${t} min</span>`).join('')}
        </div>

        <h2 class="text-lg font-semibold mt-4">Choose a context</h2>
        <div id="contextFilter" class="flex gap-2 my-2">
          ${["Workday", "Evening", "Weekend"].map(c => `<span class="pill" data-context="${c}">${c}</span>`).join('')}
        </div>

        <div class="my-4 space-x-2">
          <button id="suggestBtn" class="bg-blue-600 text-white px-4 py-2 rounded">Suggest a Task</button>
          <button id="surpriseBtn" class="bg-purple-600 text-white px-4 py-2 rounded">Surprise Me!</button>
          <button id="clearFiltersBtn" class="border px-4 py-2 rounded">Clear Filters</button>
        </div>

        <p id="noTasksMsg" class="text-gray-500">No tasks found. Try adding one.</p>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div id="modalOverlay" class="modal-overlay hidden">
    <div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg relative">
      <h3 class="text-lg font-semibold mb-4">Add New Task</h3>
      <input id="taskNameInput" type="text" placeholder="Task Name" class="w-full border px-3 py-2 rounded mb-4"/>
      
      <label class="block font-medium mb-1">Select Time</label>
      <div id="timeOptions" class="flex flex-wrap gap-2 mb-4">
        ${[5, 10, 15, 20, 30, 45, 60].map(t => `<span class="pill" data-time="${t}">${t}</span>`).join('')}
      </div>

      <label class="block font-medium mb-1">Tags</label>
      <input id="tagInput" type="text" placeholder="Type and hit Enter to add" class="w-full border px-3 py-2 rounded mb-2"/>
      <div id="tagDisplay" class="mb-4 flex flex-wrap"></div>

      <label class="block font-medium mb-1">Context</label>
      <div id="contextOptions" class="flex gap-2 mb-4">
        ${["Workday", "Evening", "Weekend"].map(c => `<span class="pill" data-context="${c}">${c}</span>`).join('')}
      </div>

      <div class="flex justify-end gap-2">
        <button id="cancelBtn" class="px-4 py-2 bg-gray-200 rounded">Cancel</button>
        <button id="saveTaskBtn" class="px-4 py-2 bg-green-600 text-white rounded">Save Task</button>
      </div>
    </div>
  </div>

  <script>
    const taskList = JSON.parse(localStorage.getItem("tasks")) || [];
    const renderTasks = () => {
      const list = document.getElementById("taskList");
      list.innerHTML = "";
      if (taskList.length === 0) {
        document.getElementById("noTasksMsg").style.display = "block";
      } else {
        document.getElementById("noTasksMsg").style.display = "none";
        taskList.forEach(task => {
          const li = document.createElement("li");
          li.textContent = `${task.name} (${task.time} min)`;
          list.appendChild(li);
        });
      }
    };

    const toggleSelection = (el, selectedClass = "pill-selected") => {
      el.classList.toggle(selectedClass);
    };

    // Show modal
    document.getElementById("addTaskBtn").onclick = () => {
      document.getElementById("modalOverlay").classList.remove("hidden");
      document.getElementById("taskNameInput").value = "";
      document.getElementById("tagInput").value = "";
      document.getElementById("tagDisplay").innerHTML = "";
      document.querySelectorAll("#timeOptions .pill").forEach(p => p.classList.remove("pill-selected"));
      document.querySelectorAll("#contextOptions .pill").forEach(p => p.classList.remove("pill-selected"));
    };

    // Cancel modal
    document.getElementById("cancelBtn").onclick = () => {
      document.getElementById("modalOverlay").classList.add("hidden");
    };

    // Handle tag entry
    const tagInput = document.getElementById("tagInput");
    const tagDisplay = document.getElementById("tagDisplay");
    const tags = new Set();
    tagInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && tagInput.value.trim()) {
        e.preventDefault();
        const tag = tagInput.value.trim();
        if (!tags.has(tag)) {
          tags.add(tag);
          const span = document.createElement("span");
          span.className = "tag-pill";
          span.textContent = tag;
          tagDisplay.appendChild(span);
        }
        tagInput.value = "";
      }
    });

    // Toggle pill selection
    document.querySelectorAll("#timeOptions .pill").forEach(pill => {
      pill.onclick = () => {
        document.querySelectorAll("#timeOptions .pill").forEach(p => p.classList.remove("pill-selected"));
        toggleSelection(pill);
      };
    });

    document.querySelectorAll("#contextOptions .pill").forEach(pill => {
      pill.onclick = () => toggleSelection(pill);
    });

    // Save task
    document.getElementById("saveTaskBtn").onclick = () => {
      const name = document.getElementById("taskNameInput").value.trim();
      const time = document.querySelector("#timeOptions .pill-selected")?.dataset.time;
      const contextEls = document.querySelectorAll("#contextOptions .pill-selected");
      const selectedContexts = Array.from(contextEls).map(el => el.dataset.context);
      const tagList = Array.from(tags);

      if (!name || !time || selectedContexts.length === 0) {
        alert("Please complete all fields.");
        return;
      }

      const newTask = { name, time: parseInt(time), contexts: selectedContexts, tags: tagList };
      taskList.push(newTask);
      localStorage.setItem("tasks", JSON.stringify(taskList));
      renderTasks();
      document.getElementById("modalOverlay").classList.add("hidden");
    };

    renderTasks();
  </script>
</body>
</html>
